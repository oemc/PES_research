---
title: "Official Development Assistance and Institutional Quality on Undeveloped countries"
author: "Oscar Eduardo Morales Cárdenas"
date: "2024-08-05"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---

# Secciones {.tabset .tabset-fade}

## Referencias

International aid may take the form of multilateral aid -- provided through international bodies such as the UN, or NGOs such as Oxfam -- or bilateral aid, which operates on a government-to-government basis. There is considerable debate about whether international aid works, in the sense of reducing poverty and stimulating development.

However, the effectiveness of aid is often diluted by corruption. Aid is invariably channeled through the governments of recipient countries, in which power is often concentrated in the hands of a few politicians and bureaucrats, and the mechanisms of accountability are, at best, poorly developed. This tends to benefit corrupt leaders and elites rather than the people, projects and programs for which it was intended.

__Watts, Carl. (2014). Re: Does foreign aid help the developing countries towards development?. Retrieved from:__ https://www.researchgate.net/post/Does_foreign_aid_help_the_developing_countries_towards_development/5322005ed039b1e7648b459c/citation/download.

The hypothesis that foreign aid can promote growth in developing countries was explored, using panel data series for foreign aid, while accounting for regional differences in Asian, African, Latin American, and the Caribbean countries as well as the differences in income levels, the results of this study also indicate that foreign aid has mixed effects on economic growth in developing countries.

__Ekanayake, E. & Chatrna, Dasha. (2010). The effect of foreign aid on economic growth in developing countries. Journal of International Business and Cultural Studies. 3.__

This study examines the relationships between foreign aid, institutional structure, and economic performance for 80 countries in Europe, America, Africa, and Asia. It is found that official development assistance and the quality of institutional structure in the sample countries affect economic growth positively.

__Hayaloğlu, Pınar. (2023). Foreign Aid, Institutions, and Economic Performance in Developing Countries. Eskişehir Osmangazi Üniversitesi İktisadi ve İdari Bilimler Dergisi. 18. 748-765. 10.17153/oguiibf.1277348.__

## Manual para replicar

### Cargando Librerias

Algunas librerias y paquetes usados para obtener y descargar los datos

```{r}
library(tidyverse) # manejo de dataframes
library(reshape2)  # para tranfromar data de long a wide
library(WDI)       # libreria para acceder a metadata de banco mundial
library(readxl)    # leer archivos de excel
library(readr)     # leer archivos csv
library(visdat)    # visualizacion de datos como graficos
library(plotly)    # graficos
library(purrr)     # funcion map
library(plm)       # modelos lineales para datos panel
library(car)       # test y utilidades para modelos
library(htmltools) # para imprimir graficos en html
```

### Obtener datos

Datos para paises bajos ingresos sean utilizados, segun clasificación del banco mundial, hay 26 paises de bajos ingresos y 51 de ingresos medios bajos

```{r}
country_class <- read_excel("CLASS.xlsx")

country_class %>%
  filter(!is.na(Region), !is.na(`Income group`)) %>%
  group_by(`Income group`) %>%
  summarise(countries = n()) %>%
  arrange(factor(`Income group`, levels = c('High income', 'Upper middle income', 'Lower middle income', 'Low income')))
```

Listado de paises a analisar:

```{r}
my_countries <- country_class %>%
  filter(!is.na(Region), `Income group` %in% c('Low income', 'Lower middle income')) %>%
  select(Code)
my_countries %>% merge(country_class) %>% select(Code, Economy)
```

Hacer la respectiva asociacion de nombres iso3c e iso2c

```{r}
my_countries$iso2c <- WDI_data$country %>%
  filter(iso3c %in% my_countries$Code) %>%
  .$iso2c
my_countries
```

Datos del banco mundial (para ODA y los indices de gobernanza) y el Human Development Reports API son descargados desde scripts de Python. Son almacenados en archivos CSV y luego son cargados aqui:

### cargar HDI

```{r}
datos_HDI <- read_csv("datos_python_HDI.csv", col_names = c('Code', 'iso2c', 'indicator', 'year', 'value'), 
                      col_types = list(col_character(), col_character(), col_character(), col_double(), col_double()))

hdi_indicators <- datos_HDI %>% distinct(indicator) %>% .$indicator
```

### cargar ODA, GDP, POP.GROW

```{r}
oda_indicators <- c(
'DT_ODA_ALLD_CD',
'DT_ODA_ALLD_KD',
'DT_ODA_OATL_CD',
'DT_ODA_OATL_KD',
'DT_ODA_ODAT_CD',
'DT_ODA_ODAT_GI_ZS',
'DT_ODA_ODAT_GN_ZS',
'DT_ODA_ODAT_KD',
'DT_ODA_ODAT_MP_ZS',
'DT_ODA_ODAT_PC_ZS',
'DT_ODA_ODAT_XP_ZS'
)
gob_indicators <- c(
'CC_EST',
'CC_NO_SRC',
'CC_PER_RNK',
'CC_PER_RNK_LOWER',
'CC_PER_RNK_UPPER',
'CC_STD_ERR',
'GE_EST',
'GE_NO_SRC',
'GE_PER_RNK',
'GE_PER_RNK_LOWER',
'GE_PER_RNK_UPPER',
'GE_STD_ERR',
'PV_EST',
'PV_NO_SRC',
'PV_PER_RNK',
'PV_PER_RNK_LOWER',
'PV_PER_RNK_UPPER',
'PV_STD_ERR',
'RQ_EST',
'RQ_NO_SRC',
'RQ_PER_RNK',
'RQ_PER_RNK_LOWER',
'RQ_PER_RNK_UPPER',
'RQ_STD_ERR',
'RL_EST',
'RL_NO_SRC',
'RL_PER_RNK',
'RL_PER_RNK_LOWER',
'RL_PER_RNK_UPPER',
'RL_STD_ERR',
'VA_EST',
'VA_NO_SRC',
'VA_PER_RNK',
'VA_PER_RNK_LOWER',
'VA_PER_RNK_UPPER',
'VA_STD_ERR'
)
gdp_indicators <- c(
'NY_ADJ_NNTY_PC_CD',
'NY_ADJ_NNTY_PC_KD',
'NY_ADJ_NNTY_PC_KD_ZG',
'NY_GDP_PCAP_CN',
'NY_GDP_PCAP_KN',
'NY_GDP_PCAP_CD',
'NY_GDP_PCAP_KD',
'NY_GDP_MKTP_KD_ZG',
'NY_GDP_DEFL_ZS_AD',
'NY_GDP_DEFL_ZS',
'NY_GDP_MKTP_CD',
'NY_GDP_MKTP_CN',
'NY_GDP_MKTP_KN',
'NY_GDP_MKTP_KD',
'NY_GDP_PCAP_KD_ZG',
'NY_GDP_PCAP_PP_KD',
'NY_GDP_PCAP_PP_CD',
'SL_GDP_PCAP_EM_KD',
'SP_POP_GROW'
)

datos_WB <- data.frame(indicator = character(), iso2c = character(), year = double(), value = double())

suppressWarnings(
  for (indicator in c(oda_indicators, gob_indicators, gdp_indicators)) {
    datos_WB <- rbind(datos_WB, read_csv(paste("datos_python", indicator, ".csv", sep =''), 
                                           col_names = c('indicator', 'iso2c', 'year', 'value'),
                                           col_types = list(col_character(), col_character(), col_double(), col_double())))
  }
)
```

### cargar POVERTY
```{r}
Poverty <- read_excel("GlobalExtremePovertyDollaraDay_Compact.xlsx", sheet = "Data Long Format")

names(Poverty) <- c("ccode", "country", "year", "value")

Poverty[Poverty=="Cape Verde"] <- "Cabo Verde"
Poverty[Poverty=="Congo"] <- "Congo, Rep."
Poverty[Poverty=="Egypt"] <- "Egypt, Arab Rep."
Poverty[Poverty=="Iran"] <- "Iran, Islamic Rep."
Poverty[Poverty=="Kyrgyzstan"] <- "Kyrgyz Republic"
Poverty[Poverty=="Laos"] <- "Lao PDR"
Poverty[Poverty=="Macedonia"] <- "North Macedonia"
Poverty[Poverty=="Russia"] <- "Russian Federation"
Poverty[Poverty=="Slovakia"] <- "Slovak Republic"
Poverty[Poverty=="South Korea"] <- "Korea, Rep."
Poverty[Poverty=="Swaziland"] <- "Eswatini"
Poverty[Poverty=="Syria"] <- "Syrian Arab Republic"
Poverty[Poverty=="The Gambia"] <- "Gambia, The"
Poverty[Poverty=="Turkey"] <- "Turkiye"
Poverty[Poverty=="Venezuela"] <- "Venezuela, RB"
Poverty[Poverty=="Yemen"] <- "Yemen, Rep."

Poverty <- Poverty %>%
  filter(year > 1994) %>%
  merge(WDI_data$country, all.x = TRUE) %>%
  mutate(indicator = 'POV') %>%
  merge(my_countries) %>%
  select(indicator, iso2c, year, value)

```

### cargar Political Civil Liberties
```{r}
PC_LIB <- read_csv("political-civil-liberties-index.csv")

PC_LIB <- PC_LIB %>%
  filter(year > 1994, !is.na(Code)) %>%
  merge(my_countries) %>%
  mutate(indicator = 'POL.CIV.LIB') %>%
  select(indicator, iso2c, year, value)
```


### Manipulacion de Datos

#### Transformar datos a la estructura wide
```{r}
datos_paper <- rbind(datos_WB, datos_HDI %>% select(indicator, iso2c, year, value), Poverty, PC_LIB) %>%
  pivot_wider(names_from = indicator, values_from = value)
```

#### Promedio de Indices de Gobernanza
```{r}
datos_paper <- datos_paper %>% mutate(GOV =  (CC.EST + GE.EST + PV.EST + RQ.EST + RL.EST + VA.EST) / 6)
```

#### Operador Diferencia

```{r}
datos_paper <- datos_paper %>% arrange(iso2c, year) %>% 
        mutate(hdi_diff = case_when(iso2c == dplyr::lag(iso2c) ~ hdi - dplyr::lag(hdi), TRUE ~ NA_real_), 
               NY.GDP.PCAP.CD_diff = case_when(iso2c == dplyr::lag(iso2c) ~ NY.GDP.PCAP.CD - dplyr::lag(NY.GDP.PCAP.CD), TRUE ~ NA_real_),
               DT.ODA.ALLD.CD_diff = case_when(iso2c == dplyr::lag(iso2c) ~ DT.ODA.ALLD.CD - dplyr::lag(DT.ODA.ALLD.CD), TRUE ~ NA_real_),
               DT.ODA.ODAT.PC.ZS_diff = case_when(iso2c == dplyr::lag(iso2c) ~ DT.ODA.ODAT.PC.ZS - dplyr::lag(DT.ODA.ODAT.PC.ZS), TRUE ~ NA_real_),
               GOV_diff = case_when(iso2c == dplyr::lag(iso2c) ~ GOV - dplyr::lag(GOV), TRUE ~ NA_real_),
               POV_diff = case_when(iso2c == dplyr::lag(iso2c) ~ POV - dplyr::lag(POV), TRUE ~ NA_real_))
```

#### Clasificaciones dicotomicas
```{r}
datos_paper <- datos_paper %>% mutate(GOV_GOOD = case_when(GOV >= 0 ~ 1, TRUE ~ 0))
plot_ly(data = datos_paper %>% filter(!is.na(GOV)), y = ~ GOV, type = 'scatter', mode = 'markers') %>%
  layout(title = 'Indice promedio de gobernanza', xaxis = list(title = 'Registros'))
```


#### Visualizacion de Datos  {.tabset .tabset-fade}

##### ODA

```{r}
vis_dat(datos_paper %>% select(all_of(gsub("_", ".", oda_indicators)))) 
  # DT.ODA.OATL.CD and DT.ODA.OATL.KD faltan
  # DT.ODA.ODAT.GI.ZS, DT.ODA.ODAT.GN.ZS, DT.ODA.ODAT.MP.ZS and DT.ODA.ODAT.XP.ZS tienen faltas
  # Un par de ocurrencias pais-año que faltan datos
```

##### GDP

```{r}
vis_dat(datos_paper %>% select(NY.GDP.PCAP.CN, NY.GDP.PCAP.CD)) 
  # NY.GDP.PCAP.CN, NY.GDP.PCAP.CD, NY.GDP.MKTP.CD, NY.GDP.MKTP.CN son buenos candidatos para usar como variables, 
  # 'SY'falta PIB per Capita en 2022, 2023 sin datos algunos paises
```

##### GOV

```{r}
vis_dat(datos_paper %>% arrange(year) %>% select(all_of(gsub("_", ".", gob_indicators)))) 
  # Datos del 2000 para atras tienen espacios faltantes 
```

##### HDI

```{r}
vis_dat(datos_paper %>% select(all_of(hdi_indicators))) 
  # abr, co2_prod, le, le_f, le_m, mmr son las pocas categorias sin datos faltantes
  # hdi faltante en multiples ocaciones
```

##### POP.GROW

```{r}
vis_dat(datos_paper %>% arrange(iso2c) %>% select(SP.POP.GROW)) 
  # ZW no tiene datos de crecimiento poblacional
```

##### POV

```{r}
vis_dat(datos_paper %>% arrange(iso2c) %>% select(POV)) 
# Hay muchos paises sin datos
```

##### POLITICAL CIVIL LIBERTY

```{r}
vis_dat(datos_paper %>% arrange(iso2c) %>% select(POL.CIV.LIB)) 
  # KI	MR	SD	WS  son paises sin datos para estos años
```

## Modelos {.tabset .tabset-fade}

### Filtros para modelo

```{r}
# variables de etiqueta
ve <- c('iso2c', 'year')
# variables depndientes
vd <- c('hdi')                # 'hdi_diff', 'NY.GDP.PCAP.CD', 'NY.GDP.PCAP.CD_diff'
# variables independientes
vi <- c('DT.ODA.ODAT.PC.ZS')  # 'DT.ODA.ALLD.CD', 'DT.ODA.ALLD.CD_diff', 'DT.ODA.ODAT.PC.ZS_diff'
# variables de control
vc <- c('NY.GDP.PCAP.CD', 'SP.POP.GROW', 'GOV') # 'CC.EST', 'GE.EST', 'PV.EST', 'RQ.EST', 'RL.EST', 'VA.EST', 'GOV_diff', 'POV', 'POV_diff', 'POL.CIV.LIB'
# variables interactivas
vint <- c() # 'GOV_GOOD'

# paises sin datos
delete_c <- c('SS', 'ZW', 'BT', 'ER', 'GW', 'KP', 'LB', 'NG', 'PS', 'SO', 'VU', 'FM', 'KI', 'TL', 'CV', 'SB', 'SY')
          #, 'KI',	'MR',	'SD',	'WS' Si se usa POL.CIV.LIB
# años sin datos
first_y <- 2002
last_y <- 2022

datos_model <- datos_paper %>% 
  filter(!iso2c %in% delete_c, !year <  first_y, !year > last_y) %>%
  select(all_of(c(ve, vd, vi, vc, vint)))

f <- paste(vd, '~', case_when(length(vint) > 0 ~ paste(vi, vint, sep = '*'), TRUE ~ vi), '+', paste(vc, collapse = ' + '))

datos_model
vis_dat(datos_model)
```

### Relaciones

Se revisara las relaciones entre las variables graficamente 

```{r}
my_plot = list()

for (vd_ in vd) {
  for (vi_ in c(vi, vc)){
    fit <- lm(paste(vd_, '~', vi_) ,data = datos_model)
    my_plot[[paste(vd_,vi_)]] <- plot_ly(x = datos_model[[vi_]], 
                                         y = datos_model[[vd_]], 
                                         type = 'scatter', 
                                         mode = 'markers', 
                                         name = vi_) %>%
      add_lines(x = datos_model[[vi_]], fitted(fit), name = paste("trace", vi_))
  }
}

subplot(my_plot, nrows = 2, margin = 0.05)  %>% layout(title = vd)

```
### Modelo OLS

```{r}
print(f)
model_ols <- lm(f, data=datos_model)
summary(model_ols)
residualPlots(model_ols)
plot(model_ols)
```

### Modelo Fixed Effects

```{r}
print(f)
model_fe <- plm(f, data=datos_model, index = ve, model = "within")
summary(model_fe)
#summary(lm(paste(f, '+ iso2c'), data=datos_model))
```

### Modelo Random Effects

```{r}
print(f)
model_re <- plm(f, data=datos_model, index = ve, model = "random")
summary(model_re)
```

### Hausman Test

```{r}
print(f)
phtest(model_fe, model_re)
```